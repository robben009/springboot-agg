#外部环境地址(云服务器地址)
extraEnvHost: 119.29.194.246

knife4j:
  # 开启增强配置
  enable: true
  # 开启生产环境屏蔽
  production: false


#https://arthas.aliyun.com/doc/tunnel.html
arthas:
  agent-id: base-web-project1
  tunnel-server: ws://127.0.0.1:7777/ws

management:
  opentelemetry:
    tracing:
      enabled: true
      sampling:
        probability: 1.0  # 采样率 100%（测试用，生产可降为 0.1）
      export:
        otlp:
          endpoint: http://119.29.194.246:4318/v1/traces  # 指向 Collector 的 OTLP HTTP 端口
          # 关键：Spring Boot 4.0 需指定协议为 HTTP（默认 gRPC，和 Collector 端口匹配）
          protocol: http/protobuf
    # 新增：opentelemetry logs 配置（导出 OTLP 日志）
    logs:
      enabled: true  # 开启 OTLP 日志导出
      export:
        otlp:
          endpoint: http://119.29.194.246:4318/v1/logs  # 指向 Collector 的 OTLP HTTP 端口
          protocol: http/protobuf  # 协议匹配 Collector 的 otlp.http
          batch:
            max_queue_size: 1024  # 批量发送队列大小
            schedule_delay: 5000ms  # 5秒批量发送
            export_timeout: 30000ms  # 超时时间
  # 可选：暴露健康/指标端点（方便手动调试）
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  # 开启指标导出
  metrics:
    tags:
      application: base-web-project  # 核心：项目唯一标识 用于给otel-collector收集器传给prometheus,在grafana中显示
      env: prod  # 可选:添加环境标签（prod/test/dev）
    export:
      enabled: true
      # 指标推送间隔（建议和Prometheus抓取间隔一致，15s）
      interval: 5s
  # OTLP 配置（核心：指向Docker中的Collector地址）
  otlp:
    metrics:
      export:
        # 替换为你的宿主机IP（容器内无法用localhost访问宿主机）
        url: http://119.29.194.246:4318/v1/metrics
        # 可选：超时时间
        timeout: 10s
        # 开启压缩（减少网络传输）
        compression: gzip


#设置项目名
server:
  tomcat:
    max-http-header-size: 65536000
  servlet:
    context-path: /base-web-project
  port: 28081

#spring的相关配置
spring:
  application:
    name: base-project
  #===============数据库=================
  #spring-boot中对于@RestController或者@Controller+@ResponseBody注解的接口方法的返回值默认是Json格式，
  #对于date类型的数据，在返回浏览器端是会被spring-boot默认的Jackson框架转换，而Jackson框架默认的时区GMT（相对于中国是少了8小时）
  #也可以去除soringboot的Jackson框架转换，使用fastjson框架
  jackson:
    time-zone: GMT+8
  datasource:
    url: jdbc:mysql://${extraEnvHost}:53306/springBootDemo?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&allowMultiQueries=true&rewriteBatchedStatements=true
    username: ${jdbc.username}
    password: ${jdbc.pwd}
    driver-class-name: com.mysql.cj.jdbc.Driver
  #本地缓存的配置
  cache:
    type: caffeine
    #该配置项在com.robben.config.CaffeineCacheConfig 也可以实现配置
  #    cache-names:
  #      - userCache
  #    caffeine:
  #      spec: maximumSize=1024,refreshAfterWrite=60s
  data:
    redis:
      host: ${extraEnvHost}
      port: 56379
      password: ${redis.pwd}


##日志的配置
#logging:
#  level:
#    com.robben: info


logging:
  pattern:
    level: "%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]"  # 日志中包含应用名、traceID、spanID
  level:
    root: INFO  # 日志级别，生产环境可调整为 WARN
    org.springframework.web: DEBUG  # 可选：开启 web 日志调试
